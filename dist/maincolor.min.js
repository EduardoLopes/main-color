/**
* !@autor        Eduardo Lopes <EduardoLopesDS@gmail.com>
* !@copyright    2015 Eduardo Lopes
* !@license      {@link https://github.com/EduardoLopes/main-color/blob/master/LICENSE|MIT License}
*/
!function(){"use strict";function t(t){var t=t||{};this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.imageData=null,this.colors=[],this.colorsScore=[],this.rafID=0,this.mainColorScore=0,this.tiles={size:{x:0,y:0},row:0,col:0,current:0},this.setAccuracy(t.accuracy||25),this.img.onload=this.onImageLoad.bind(this)}t.prototype={version:"0.0.9",setCanvasSize:function(t,i){this.canvas.width=t,this.canvas.height=i,this.updateTiles(),this.resetStep()},setAccuracy:function(t){this.tiles.row=Math.max(1,Math.min(t,50)),this.tiles.col=Math.max(1,Math.min(t,50))},resetStep:function(){this.tiles.current=this.tiles.row*this.tiles.col,this.colors.length=0,this.colorsScore.length=0,this.mainColorScore=0},updateTiles:function(){this.tiles.size.x=Math.floor(this.canvas.width/this.tiles.col),this.tiles.size.y=Math.floor(this.canvas.height/this.tiles.row)},setImage:function(t){"object"==typeof t&&(this.img.src=t.src),"string"==typeof t&&(this.img.src=t)},onImageLoad:function(){var t=1;(this.img.width>600||this.img.height>800)&&(t=.5),this.setCanvasSize(this.img.width*t,this.img.height*t),this.ctx.drawImage(this.img,0,0,this.img.width*t,this.img.height*t),this.imageData=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),this.onSearchStart(),this.step()},onSearchStart:!1,onFindColor:!1,searchMainColor:function(){var t=this.colorsScore.indexOf(this.mainColorScore);return this.onFindColor(this.colors[t]),this.colors[t]},getPixel:function(t,i){var s,e,h,o,a;return a=4*(t+i*this.imageData.width),s=this.imageData.data[a+0],e=this.imageData.data[a+1],h=this.imageData.data[a+2],o=this.imageData.data[a+3],null==s||null==e||null==h||null==o?!1:"rgba("+s+","+e+","+h+","+o+")"},step:function(){var t,i,s,e,h,o,a;if(!(this.tiles.current>=0))return this.searchMainColor(),cancelAnimationFrame(this.rafID),!1;for(i=this.tiles.current/this.tiles.col>>0,h=this.tiles.col;h>=0;h--){for(t=this.tiles.current-i*h,s=0;2>s;s++)for(e=0;2>e;e++)o=this.getPixel(t*this.tiles.size.x+this.tiles.size.x/3+e*(this.tiles.size.x/2)>>0,i*this.tiles.size.y+this.tiles.size.y/3+s*(this.tiles.size.y/3)>>0),a=this.colors.indexOf(o),o&&(-1==a?(this.colors[this.colors.length]=o,this.colorsScore[this.colors.length]=1):(null==this.colorsScore[a]&&(this.colorsScore[a]=0),this.colorsScore[a]+=1,this.mainColorScore=Math.max(this.mainColorScore,this.colorsScore[a])));this.tiles.current-=1}this.rafID=requestAnimationFrame(this.step.bind(this))}},window.MainColor=t}(window);